<!DOCTYPE html>
<html>
<head>
  <title>Audio Byte Receiver</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
    #output { white-space: pre-wrap; font-family: monospace; background: #222; padding: 10px; margin-top: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>ðŸŽ§ Audio Byte Receiver</h1>
  <p>Click "Start Listening" and transmit sound from another tab or device.</p>
  <button onclick="startListening()">Start Listening</button>
  <div id="output">Waiting for data...</div>

  <script>
    let outputDiv = document.getElementById("output");
    let receivedText = "";
    let byteBuffer = [];

    async function startListening() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createMediaStreamSource(stream);
      const analyser = audioCtx.createAnalyser();

      analyser.fftSize = 2048;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      source.connect(analyser);

      function detectFrequency() {
        analyser.getByteFrequencyData(dataArray);

        // Get max amplitude frequency
        let maxIndex = 0;
        for (let i = 1; i < bufferLength; i++) {
          if (dataArray[i] > dataArray[maxIndex]) {
            maxIndex = i;
          }
        }

        const frequency = maxIndex * audioCtx.sampleRate / analyser.fftSize;

        // Attempt to map frequency to byte (if near expected range)
        if (frequency >= 1000 && frequency <= 5000) {
          const byte = Math.round((frequency - 1000) / 15);
          const expectedFreq = 1000 + byte * 15;
          const tolerance = 10;

          if (Math.abs(frequency - expectedFreq) < tolerance) {
            if (byte >= 0 && byte <= 255) {
              const char = String.fromCharCode(byte);
              receivedText += char;
              outputDiv.textContent = receivedText;
            }
          }
        }

        requestAnimationFrame(detectFrequency);
      }

      detectFrequency();
    }
  </script>
</body>
</html>
